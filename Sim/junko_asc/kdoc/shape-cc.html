<HTML>
<HEAD><TITLE>./kdoc/shape-cc</TITLE></HEAD>
<BODY BGCOLOR="#ffffff">
<PRE>#include &quot;simeb.h&quot;

TShape * TShape::Parse(TParser &parser)
{
  TShape * shape = NULL;
  char s_token[MAX_TOKEN];

  parser &gt;&gt; s_token;
  if (!strcmp(s_token, &quot;Point&quot;)) shape = new TShapePoint();
  if (!strcmp(s_token, &quot;Circle&quot;)) shape = new TShapeCircle();
  if (!strcmp(s_token, &quot;Bagel&quot;)) shape = new TShapeBagel();
  if (!strcmp(s_token, &quot;Square&quot;)) shape = new TShapeSquare();
  if (!strcmp(s_token, &quot;Rectangle&quot;)) shape = new TShapeRectangle();
  if (!shape) parser.Error();

  parser &gt;&gt; s_token;
  if (strcmp(s_token, &quot;{&quot;)) parser.Error();

  for (;;) {
    parser &gt;&gt; s_token;
    if (parser.Eof()) parser.Error();
    if (!strcmp(s_token, &quot;}&quot;)) break;
    shape-&gt;Parse(parser, s_token);
  }
  return shape;
}

void TShape::Parse(TParser &parser, char *s_token) {
  if (!strcmp(s_token, &quot;Offset&quot;)) parser &gt;&gt; xyOffset;
  else parser.Error();
}

TShapePoint::TShapePoint(void) : TShape() {return;}
void TShapePoint::Parse(TParser &parser, char *s_token)
  {TShape::Parse(parser, s_token);}
void TShapePoint::Randomize(Particle *p) {p-&gt;xyzP = xyOffset; return;}
bool TShapePoint::bInside(TXY xy) {return false;}

TShapeCircle::TShapeCircle(void) : TShape() {rRadius = 0.0;}
void TShapeCircle::Parse(TParser &parser, char *s_token)
{
  if (!strcmp(s_token, &quot;Radius&quot;)) parser &gt;&gt; rRadius;
  else if (!strcmp(s_token, &quot;Diameter&quot;)) {parser &gt;&gt; rRadius; rRadius /= 2;}
  else TShape::Parse(parser, s_token);
}
void TShapeCircle::Randomize(Particle * p)
{
  real r_radius = rRadius * sqrt(drand48());
  real r_alpha = 2*M_PI*drand48();
  p-&gt;xyzP.rX = r_radius * cos(r_alpha);
  p-&gt;xyzP.rY = r_radius * sin(r_alpha);
  p-&gt;xyzP += xyOffset;
}
bool TShapeCircle::bInside(TXY xy)
{
  xy -= xyOffset;
  return xy.rX*xy.rX + xy.rY*xy.rY &lt; rRadius*rRadius;
}

TShapeBagel::TShapeBagel(void) : TShape() {rRadius = 0.0; rHole = 0.0;}
void TShapeBagel::Parse(TParser &parser, char *s_token)
{
  if (!strcmp(s_token, &quot;Radius&quot;)) parser &gt;&gt; rRadius;
  else if (!strcmp(s_token, &quot;Diameter&quot;)) {parser &gt;&gt; rRadius; rRadius /= 2;}
  else if (!strcmp(s_token, &quot;Hole&quot;)) {parser &gt;&gt; rHole; rHole /= 2;}
  else TShape::Parse(parser, s_token);
}
void TShapeBagel::Randomize(Particle * p)
{
  if (rRadius &lt;= rHole) {
    cerr &lt;&lt; &quot;Bad Bagel Parameters!\n&quot;;
    exit(0);
  }

  real r_radius = 0.0;
  while ((r_radius  = rRadius * sqrt(drand48())) &lt; rHole);
  real r_alpha = 2*M_PI*drand48();
  p-&gt;xyzP.rX = r_radius * cos(r_alpha);
  p-&gt;xyzP.rY = r_radius * sin(r_alpha);
  p-&gt;xyzP += xyOffset;
}
bool TShapeBagel::bInside(TXY xy)
{
  xy -= xyOffset;
  if (xy.rX*xy.rX + xy.rY*xy.rY &gt; rRadius*rRadius) return false;
  if (xy.rX*xy.rX + xy.rY*xy.rY &lt; rHole*rHole) return false;
  return true;
}

TShapeSquare::TShapeSquare(void) : TShape() {rSize = 0.0;}
void TShapeSquare::Parse(TParser &parser, char *s_token)
{
  if (!strcmp(s_token, &quot;Size&quot;)) parser &gt;&gt; rSize;
  else TShape::Parse(parser, s_token);
}
void TShapeSquare::Randomize(Particle * p)
{
  p-&gt;xyzP.rX = rSize * drand48() - rSize/2;
  p-&gt;xyzP.rY = rSize * drand48() - rSize/2;
  p-&gt;xyzP += xyOffset;
}
bool TShapeSquare::bInside(TXY xy)
{
  xy -= xyOffset;
  if (fabs(xy.rX) &gt; rSize/2) return false;
  if (fabs(xy.rY) &gt; rSize/2) return false;
  return true;
}

TShapeRectangle::TShapeRectangle(void) : TShape() {xySize = xy0;}
void TShapeRectangle::Parse(TParser &parser, char *s_token)
{
  if (!strcmp(s_token, &quot;Size&quot;)) parser &gt;&gt; xySize;
  else TShape::Parse(parser, s_token);
}
void TShapeRectangle::Randomize(Particle * p)
{
  p-&gt;xyzP.rX = xySize.rX * drand48() - xySize.rX/2;
  p-&gt;xyzP.rY = xySize.rY * drand48() - xySize.rY/2;
  p-&gt;xyzP += xyOffset;
}
bool TShapeRectangle::bInside(TXY xy)
{
  xy -= xyOffset;
  if (fabs(xy.rX) &gt; xySize.rX/2) return false;
  if (fabs(xy.rY) &gt; xySize.rY/2) return false;
  return true;
}

</PRE>
<HR>
<address>Documentation generated by ktaka@junko on Thu Dec 16 18:04:15 PST 1999
</address>
</BODY>
</HTML>
