<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>Particle Include File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 0.49-991205 on Thu Dec 16 20:38:29 1999 -->
<center>
<a class="qindex"href="index.html">Main Page</a> &nbsp; <a class="qindex"href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex"href="annotated.html">Compound List</a> &nbsp; <a class="qindex"href="files.html">File List</a> &nbsp; <a class="qindex"href="headers.html">Header Files</a> &nbsp; <a class="qindex"href="functions.html">Compound Members</a> &nbsp; <a class="qindex"href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>particle.h</h1>This is the verbatim text of the particle.h include file.<div class="fragment"><pre>#ifndef _PARTICLE
#define _PARTICLE

class <a class="code" href="class_particle.html">Particle</a>
{
 public:
  int iPlane;
  int iId;
  int iBeam;

  #ifdef _SIMEB_CAP_GROUP
  int iGroup;
  #endif

  #ifdef _SIMEB_CAP_ACCEL
  real rFieldA;
  #endif

  #ifdef _SIMEB_CAP_MIRROR
  int iMirror;
  #endif

  inline real <a class="code" href="class_particle.html#a0">Impact</a>(real const r_dz);
  inline bool <a class="code" href="class_tplane.html#a4">Cross</a>(real const r_dz);
  inline bool <a class="code" href="class_particle.html#a2">bIncrPlane</a>(void);

  static int <a class="code" href="class_particle.html#d0">EmissionOrder</a>(<a class="code" href="class_particle.html">Particle</a> const * const *, <a class="code" href="class_particle.html">Particle</a> const * const *);
  <a class="code" href="class_particle.html#a3">Particle</a>();

  <a class="code" href="class_txyz.html">TXYZ</a>    xyzP;
  <a class="code" href="class_txyz.html">TXYZ</a>    xyzV;
  <a class="code" href="class_txyz.html">TXYZ</a>    xyzPCommit;
  <a class="code" href="class_txyz.html">TXYZ</a>    xyzVCommit;

  real    rPert;
  real    rTi, rTf, rDt;

  int     iTOrder;
  int     iZOrder;

  #ifndef _SIMEB_CAP_ACCEL
  static void <a class="code" href="class_tplane.html#a14">rSetFieldA</a>(real) {};
  static real <a class="code" href="class_tplane.html#a12">rGetFieldA</a>() {return 0.0;};
  #endif

  #ifdef _SIMEB_CAP_ACCEL
  void <a class="code" href="class_tplane.html#a14">rSetFieldA</a>(real r_field_a) {rFieldA = r_field_a;};
  real <a class="code" href="class_tplane.html#a12">rGetFieldA</a>() const {return rFieldA;};
  #endif

  #ifndef _SIMEB_CAP_GROUP
  static int  <a class="code" href="class_particle.html#d3">iGetGroup</a>(void) {return 0;};
  static void <a class="code" href="class_particle.html#d4">iSetGroup</a>(int) {};
  static void <a class="code" href="class_particle.html#d5">iClearGroup</a>(int) {};
  #endif
 
  #ifdef _SIMEB_CAP_GROUP
  int  <a class="code" href="class_particle.html#d3">iGetGroup</a>(void) const {return iGroup;};
  void <a class="code" href="class_particle.html#d4">iSetGroup</a>(int i_group) {iGroup |= i_group;};
  void <a class="code" href="class_particle.html#d5">iClearGroup</a>(int i_group) {iGroup &amp;= ~i_group;};
  #endif

  int <a class="code" href="class_tplane.html#a6">iGetPlane</a>(void) const {return iPlane;};
  int <a class="code" href="class_particle.html#a5">iGetId</a>(void)    const {return iId;};
  int <a class="code" href="class_particle.html#a6">iGetBeam</a>(void)  const {return iBeam;};

  void <a class="code" href="class_particle.html#a7">iSetId</a>(int const i_id) {iId = i_id;};
  void <a class="code" href="class_particle.html#a8">iSetBeam</a>(int const i_beam) {iBeam = i_beam;};

  inline void <a class="code" href="class_particle.html#a9">Commit</a>(void);
  inline void <a class="code" href="class_particle.html#a10">Fly</a>(<a class="code" href="class_txyz.html">TXYZ</a> &amp; xyz_p, <a class="code" href="class_txyz.html">TXYZ</a> &amp; xyz_v, real const r_dt) const;
  inline void <a class="code" href="class_particle.html#a11">FlyZ</a>(real &amp; r_pz, real &amp; r_vz, real const r_dt) const;
  inline void <a class="code" href="class_particle.html#a12">TimeStepIncr</a>(real const r_epsilon);
  inline void <a class="code" href="class_particle.html#a13">TimeStepDecr</a>(real const r_epsilon);
  inline void <a class="code" href="class_particle.html#a14">TimeStepTrunc</a>(real const r_ti, real const r_pert, real const r_epsilon);
  inline bool <a class="code" href="class_particle.html#a15">NextEvent</a>(void);
};


inline void <a class="code" href="class_particle.html#a9">Particle::Commit</a>(void)
{
  <a class="code" href="class_particle.html#a10">Fly</a>(xyzP, xyzV, rTf - rTi);

  xyzP += xyzPCommit;
  xyzV += xyzVCommit;
  xyzPCommit = xyzVCommit = xyz0;
}

inline void <a class="code" href="class_particle.html#a10">Particle::Fly</a>(<a class="code" href="class_txyz.html">TXYZ</a> &amp; xyz_p, <a class="code" href="class_txyz.html">TXYZ</a> &amp; xyz_v, real const r_dt) const {
  if (rGetFieldA() == 0.0) xyz_p += r_dt * xyz_v;
  else {
    xyz_p.rX += r_dt * xyz_v.rX;
    xyz_p.rY += r_dt * xyz_v.rY;
    FlyZ(xyz_p.rZ, xyz_v.rZ, r_dt);
  }
};


inline void <a class="code" href="class_particle.html#a11">Particle::FlyZ</a>(real &amp; r_pz, real &amp; r_vz, real const r_dt) const {
  if (rGetFieldA() == 0.0) {r_pz += r_dt*r_vz; return;}
  
  r_pz += r_vz * r_dt + 0.5 * rGetFieldA() * r_dt*r_dt;
  r_vz += rGetFieldA() * r_dt;
};

inline void <a class="code" href="class_particle.html#a12">Particle::TimeStepIncr</a>(real const r_epsilon) {
  if (rPert == 0.0) rDt = FLT_MAX;
  else if (rDt &lt; 2*(rTf-rTi)) rDt *= sqrt(r_epsilon / rPert);

  rPert = 0.0;
  rTi = rTf;
};

inline void <a class="code" href="class_particle.html#a13">Particle::TimeStepDecr</a>(real const r_epsilon) {
  rDt = (rTf-rTi) / (1 + sqrt(rPert / r_epsilon));

  rPert = 0.0;
  rTf = rTi;
};


inline void <a class="code" href="class_particle.html#a14">Particle::TimeStepTrunc</a>(real const r_ti, real const r_pert, real const r_epsilon) {
  rDt = (rTf-rTi) / (1 + sqrt(rPert / r_epsilon));

  rPert -= r_pert;
  rTf = r_ti;
};

inline bool <a class="code" href="class_particle.html#a15">Particle::NextEvent</a>(void) {
  real r_dz;

  while ((r_dz = <a class="code" href="class_column.html#d3">Column::rGetZ</a>(iPlane) - xyzP.rZ) &lt; <a class="code" href="class_column.html#d4">Column::rGetCapture</a>())
    if (!<a class="code" href="class_tplane.html#a4">Cross</a>(r_dz)) return false;

  rTf += rDt &lt;? <a class="code" href="class_particle.html#a0">Impact</a>(r_dz);

  return true;
};

inline bool <a class="code" href="class_tplane.html#a4">Particle::Cross</a>(real const r_dz)
{
  real r_dt = <a class="code" href="class_particle.html#a0">Impact</a>(r_dz);

  <a class="code" href="class_particle.html#a10">Fly</a>(xyzP, xyzV, r_dt);

  if (!<a class="code" href="class_column.html#d2">Column::GetPlane</a>(iPlane)-&gt;Cross(this)) return false;
  if (!<a class="code" href="class_particle.html#a2">bIncrPlane</a>()) return false;

  <a class="code" href="class_particle.html#a10">Fly</a>(xyzP, xyzV, -r_dt);

  return true;
};


inline real <a class="code" href="class_particle.html#a0">Particle::Impact</a>(real const r_dz) {
  if (r_dz == 0.0) return 0.0;

  const real r_vz = xyzV.rZ;

  real r_dt;
  if (<a class="code" href="class_tplane.html#a12">rGetFieldA</a>() == 0.0) r_dt = r_dz / r_vz;
  else r_dt = 2*r_dz / (r_vz + sqrt(r_vz*r_vz + 2*<a class="code" href="class_tplane.html#a12">rGetFieldA</a>()*r_dz));

  return r_dt;
};


inline bool <a class="code" href="class_particle.html#a2">Particle::bIncrPlane</a>(void)
{
  <a class="code" href="class_tplane.html">TPlane</a> * plane = <a class="code" href="class_column.html#d2">Column::GetPlane</a>(iPlane);

  <a class="code" href="class_tplane.html#a14">rSetFieldA</a>(plane-&gt;<a class="code" href="class_tplane.html#a12">rGetFieldA</a>());

  <a class="code" href="class_particle.html#d4">iSetGroup</a>(plane-&gt;<a class="code" href="class_tplane.html#a10">iGetSetGroup</a>());
  <a class="code" href="class_particle.html#d5">iClearGroup</a>(plane-&gt;<a class="code" href="class_tplane.html#a11">iGetClearGroup</a>());

  if (++iPlane == <a class="code" href="class_column.html#d0">Column::iGetNumPlanes</a>()) return false;
  return true;
};

#endif
</div></pre><hr><address><small>Generated at Thu Dec 16 20:38:29 1999 for simeb_ebit by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=118 height=53></a> 0.49-991205 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-1999</small></address>
</body>
</html>
